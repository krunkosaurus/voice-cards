---
phase: 06-qr-code-support
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - client/package.json
  - client/src/components/QRCodeDisplay.tsx
  - client/src/hooks/useCameraAvailability.ts
autonomous: true

must_haves:
  truths:
    - "QR code renders from encoded SDP string"
    - "Camera availability can be detected without permission prompt"
  artifacts:
    - path: "client/src/components/QRCodeDisplay.tsx"
      provides: "QR code rendering component"
      exports: ["QRCodeDisplay"]
    - path: "client/src/hooks/useCameraAvailability.ts"
      provides: "Camera detection hook"
      exports: ["useCameraAvailability", "hasCameraAvailable"]
  key_links:
    - from: "client/src/components/QRCodeDisplay.tsx"
      to: "qrcode.react"
      via: "QRCodeSVG import"
      pattern: "import.*QRCodeSVG.*from.*qrcode.react"
---

<objective>
Install QR libraries and create QRCodeDisplay component with camera availability hook.

Purpose: Establish foundation for QR code display and camera detection before integrating into ConnectionDialog.
Output: QRCodeDisplay component, useCameraAvailability hook, libraries installed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-qr-code-support/06-RESEARCH.md
@.planning/phases/06-qr-code-support/06-CONTEXT.md
@client/src/components/ConnectionDialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install QR libraries</name>
  <files>client/package.json</files>
  <action>
Install qrcode.react and html5-qrcode:
```bash
cd client && pnpm add qrcode.react html5-qrcode
```

Verify both packages appear in package.json dependencies.
  </action>
  <verify>
`grep -E "qrcode.react|html5-qrcode" client/package.json` shows both packages
  </verify>
  <done>Both qrcode.react and html5-qrcode installed in client/package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create QRCodeDisplay component</name>
  <files>client/src/components/QRCodeDisplay.tsx</files>
  <action>
Create a simple stateless QR code display component:

```typescript
// components/QRCodeDisplay.tsx - QR code generation from encoded SDP
import { QRCodeSVG } from 'qrcode.react';

interface QRCodeDisplayProps {
  code: string;
  size?: number;
}

export function QRCodeDisplay({ code, size = 192 }: QRCodeDisplayProps) {
  return (
    <QRCodeSVG
      value={code}
      size={size}
      level="M"           // Medium error correction - good balance for ~1000 char codes
      bgColor="#FFFFFF"
      fgColor="#000000"
      marginSize={2}      // Small quiet zone
    />
  );
}
```

Key points from CONTEXT.md:
- Size 192px (180-200px range for scanability)
- Standard black/white for maximum compatibility
- Level "M" for balance between density and error correction
  </action>
  <verify>
`grep -l "QRCodeSVG" client/src/components/QRCodeDisplay.tsx` returns the file
  </verify>
  <done>QRCodeDisplay component exists with QRCodeSVG, level="M", size=192</done>
</task>

<task type="auto">
  <name>Task 3: Create useCameraAvailability hook</name>
  <files>client/src/hooks/useCameraAvailability.ts</files>
  <action>
Create hook to detect camera availability without triggering permission prompt:

```typescript
// hooks/useCameraAvailability.ts - Check camera exists before showing scan option
import { useState, useEffect } from 'react';

/**
 * Check if a camera device exists without triggering permission prompt.
 * Uses enumerateDevices() which doesn't require permission.
 */
export async function hasCameraAvailable(): Promise<boolean> {
  if (!navigator.mediaDevices?.enumerateDevices) {
    return false;
  }

  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    return devices.some(device => device.kind === 'videoinput');
  } catch {
    return false;
  }
}

/**
 * React hook for camera availability.
 * Returns null while checking, boolean once known.
 */
export function useCameraAvailability() {
  const [hasCamera, setHasCamera] = useState<boolean | null>(null);

  useEffect(() => {
    hasCameraAvailable().then(setHasCamera);
  }, []);

  return hasCamera;
}
```

Per CONTEXT.md: "Proactively check for camera before showing scan option - hide if unavailable"
Per RESEARCH.md: enumerateDevices() doesn't trigger permission prompt
  </action>
  <verify>
`grep -l "enumerateDevices" client/src/hooks/useCameraAvailability.ts` returns the file
  </verify>
  <done>useCameraAvailability hook and hasCameraAvailable function exist</done>
</task>

</tasks>

<verification>
- `pnpm --filter client list qrcode.react html5-qrcode` shows both installed
- `ls client/src/components/QRCodeDisplay.tsx` exists
- `ls client/src/hooks/useCameraAvailability.ts` exists
- Build passes: `cd client && pnpm build` (no TypeScript errors)
</verification>

<success_criteria>
- qrcode.react and html5-qrcode installed
- QRCodeDisplay component renders QR code from code prop
- useCameraAvailability hook detects camera without permission prompt
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-qr-code-support/06-01-SUMMARY.md`
</output>
